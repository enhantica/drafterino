name: Update release draft

on:
  push:
    branches:
      - main
      - master
      - develop

jobs:
  drafterino-notes:
    permissions:
      contents: write

    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Zip the README.md
        run: zip -r README.zip README.md

      - name: Debug Git state
        run: |
          echo "üîß Starting release preparation..."
          git fetch --tags --force
          echo "üîñ Latest tag:"
          git describe --tags --abbrev=0 || echo "none"
          echo "üßæ Recent commits:"
          git log -n 5 --oneline
          echo "üìÅ Current directory:"
          pwd
          echo "üìÑ Files:"
          ls -l

      - name: Drafts the next release notes
        uses: enhantica/drafterino@develop

        with:
          config: |
            title: 'drafterino $COMPUTED_VERSION'
            tag: 'v$COMPUTED_VERSION'
            note-template: '- $PR_TITLE (#$PR_NUMBER)'

            default-bump: post

            major-bump-labels: ['[scope] significant']
            minor-bump-labels: ['[scope] enhancement']
            patch-bump-labels: ['[scope] bug', '[scope] maintenance']
            post-bump-labels: ['[scope] documentation']

            release-notes:
              - title: 'Added'
                labels: ['[scope] significant', '[scope] enhancement']
              - title: 'Fixed'
                labels: ['[scope] bug']
              - title: 'Changed'
                labels: ['[scope] maintenance', '[scope] documentation']
          files: |
            README.zip

        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
